#!/usr/bin/env python
# -*- coding: utf-8 -*-

"""
Shared Configuration
-------------------
This file contains shared variables and configurations used across the news clipping application.
Centralizing these variables makes maintenance easier and ensures consistency.
"""

# Company categories and definitions
COMPANY_CATEGORIES = {
    "Corporate": {
        "Anchor": ["삼성", "SK", "LG", "현대차", "롯데", "한화", "포스코"],
        "Growth_Whitespace": ["HD현대", "CJ", "신세계", "GS", "LS"]
    },
    "Financial": {
        "금융지주": ["KB금융", "하나금융", "신한금융", "우리금융", "NH금융", "새마을금고등", "지방은행(iM금융 포함) 및 비은행 금융지주", "기타"],
        "비지주금융그룹": ["삼성(금융)", "한화(금융)", "현대차(금융)","기타(미래에셋, 교보, DB, 다우키움)"],
        "핀테크": ["카카오뱅크", "토스", "케이뱅크", "네이버파이낸셜", "두나무", "트래블월렛"]
    }
}

COMPANY_CATEGORIES_TEST = {
    "Corporate": {
        "Anchor": ["삼성"],
        "Growth_Whitespace": ["HD현대"]
    },
    "Financial": {
        "금융지주": ["KB금융","지방은행(iM금융 포함) 및 비은행 금융지주"],
        "비지주금융그룹": ["한화(금융)"],
        "핀테크": ["카카오뱅크"]
    }
}


# 카테고리별 활성화 설정
ACTIVE_CATEGORIES = {
    "Corporate": True,
    "Financial": True
}

# Default to Corporate companies for testing
DEFAULT_COMPANIES = COMPANY_CATEGORIES["Corporate"]["Anchor"]  # 테스트용으로 변경

# Company keyword map - mapping companies to their related keywords
COMPANY_KEYWORD_MAP = {
    # Anchor 카테고리 (Corporate)
    "포스코": ["포스코", "포스코그룹", "포스코인터내셔널", "포스코DX"],
    "삼성": ["삼성", "삼성전자", "삼성그룹", "삼성바이오로직스", "삼성SDI"],
    "SK": ["SK", "SK하이닉스", "SK이노베이션", "SK텔레콤", "SK그룹","SK이노"],
    "현대차": ["현대차", "현대자동차", "현대모비스", "현대차그룹", "기아"],
    "LG": ["LG", "LG전자", "LG화학", "LG디스플레이", "LG그룹"],
    "롯데": ["롯데", "롯데그룹", "롯데케미칼", "롯데쇼핑", "롯데제과", "신동빈"],
    "한화": ["한화", "한화그룹", "한화에어로스페이스", "한화솔루션", "한화생명"],
    
    # Growth_Whitespace 카테고리 (Corporate)
    "CJ": ["CJ", "CJ그룹", "씨제이대한통운", "CJ제일제당", "씨제이이앤엠", "씨제이푸드빌", "씨제이지엘에스", "씨제이올리브영","씨제이", "CJ 대한통운", "CJ ENM", "CJ푸드빌", "CJ GLS", "CJ올리브영", "CJ올리브네트웍스"],
    "HD현대": ["HD현대", "에이치디현대", "현대중공업", "에이치디현대오일뱅크", "에이치디한국조선해양", "에이치디현대인프라코어", "에이치디현대일렉트릭", "현대오일터미널", "에이치디현대건설기계", "에이치디현대", "현대重"],
    "신세계": ["신세계", "이마트", "조선호텔앤리조트", "신세계푸드", "신세계인터내셔날", "이마트24", "신세계센트럴시티","SSG"],
    "GS": ["GS", "지에스건설", "지에스칼텍스", "지에스리테일", "지에스에너지", "지에스홈쇼핑", "지에스글로벌", "GS건설", "GS칼텍스", "GS리테일", "GS에너지", "GS홈쇼핑", "GS글로벌", "GS25"],
    "LS": ["LS", "엘에스일렉트릭", "엘에스전선", "엘에스엠앤엠", "엘에스글로벌인코퍼레이티드", "엘에스아이앤디", "엘에스메탈", "LS일렉트릭", "LS전선", "LS M&M", "LS글로벌인코퍼레이티드", "LS I&D", "LS메탈"],
    
    # 금융지주 카테고리 (Financial)
    "KB금융": ["KB", "KB銀", "KB금융", "KB금융지주", "KB국민은행", "KB손해보험", "KB캐피탈", "KB생명", "국민은행", "KB자산운용","KB운용"],
    "하나금융": ["하나금융", "하나銀", "하나금융지주", "하나은행", "하나카드", "하나금융투자", "하나캐피탈", "하나생명", "하나금융그룹","하나운용","핀크"],
    "신한금융": ["신한", "신한금융", "신한금융지주", "신한은행", "신한카드", "신한자산운용", "신한라이프생명보험", "제주은행", "신한은행", "신한銀", "신한금융지주","신한운용"],
    "우리금융": ["우리금융", "우리금융지주", "우리은행", "우리금융캐피탈", "우리銀", "우리금융그룹","우리운용","우리자산운용"],
    "NH금융": ["NH", "농협銀", "농협은행", "농협경제지주", "농협금융지주", "농협유통", "농협손해보험", "엔에이치저축은행", "농협", "NH농협", "NH손보","NH투자증권","NH농협캐피탈","NH농협생명명"],
    "새마을금고등": ["새마을금고","IBK기업은행", "수협", "신협","SH수협"],
    "지방은행(iM금융 포함) 및 비은행 금융지주": ["BNK금융", "BNK금융지주", "부산은행", "경남은행", "BNK부산은행", "BNK경남은행", "부산銀", "BNK자산운용", "BNK캐피탈", "BNK저축은행","JB금융", "JB금융지주", "광주은행", "전북은행", "JB광주은행", "JB전북은행", "전북銀", "JB우리캐피탈", "JB자산운용", "한국투자", "한국투자금융지주", "한국투자홀딩스","메리츠금융지주", "메리츠금융", "메리츠종금","iM금융", "iM금융지주", "대구은행", "DGB금융", "DGB금융지주", "DGB대구은행", "IM뱅크", "IM라이프", "IM캐피탈", "IM자산운용"],
    "기타": ["4대금융", "5대금융", "시중은행"],
    #비지주금융그룹
    "삼성(금융)": ["삼성생명", "삼성화재", "삼성카드", "삼성자산운용","삼성운용"],
    "한화(금융)": ["한화생명", "한화손해보험", "한화손보", "한화자산운용", "한화저축은행", "캐롯손해보험", "캐롯손보","한화운용"],
    "현대차(금융)": ["현대캐피탈", "현대카드"],
    "기타(미래에셋, 교보, DB, 다우키움)" : ["미래에셋", "미래에셋생명", "미래에셋자산운용", "미래에셋펀드", "미래에셋캐피탈", "미래에셋벤처투자", "교보", "교보생명", "교보악사", "교보악사자산운용", "교보라이프", "교보라이프플래닛", "DB손해보험", "DB손보", "DB생명", "DB금융투자", "키움", "키움저축은행", "키움에셋플래너", "키움인베스트먼트", "키움에프앤아이", "키움캐피탈", "키움"],
    # 핀테크 카테고리 (Financial)
    "카카오뱅크": ["카카오뱅크", "카카오페이", "카카오페이보험"],
    "토스": ["토스뱅크", "토스페이먼츠","토스인슈어런스","토스","토스증권","비바리퍼블리카","토스플레이스"],
    "케이뱅크": ["케이뱅크", "K뱅크", "KBank"],
    "네이버파이낸셜": ["네이버파이낸셜", "네이버페이"],
    "두나무": ["두나무", "업비트", "Upbit"],
    "트래블월렛": ["트래블월렛", "TravelWallet"]
}
    # "미래에셋": ["미래에셋", "미래에셋생명", "미래에셋자산운용", "미래에셋펀드", "미래에셋캐피탈", "미래에셋벤처투자"],
    # "교보": ["교보", "교보생명", "교보악사", "교보악사자산운용", "교보라이프", "교보라이프플래닛"],
    # "DB": ["DB손해보험", "DB손보", "DB생명", "DB금융투자"],
    # "다우키움": ["키움", "키움저축은행", "키움에셋플래너", "키움인베스트먼트", "키움에프앤아이", "키움캐피탈", "키움"],

# Trusted press aliases by category
TRUSTED_PRESS_ALIASES_BY_CATEGORY = {
    "Corporate": {
        "조선일보": ["조선일보", "chosun", "chosun.com"],
        "중앙일보": ["중앙일보", "joongang", "joongang.co.kr", "joins.com"],
        "동아일보": ["동아일보", "donga", "donga.com"],
        "조선비즈": ["조선비즈", "chosunbiz", "biz.chosun.com"],
        "매거진한경": ["매거진한경", "magazine.hankyung", "magazine.hankyung.com"],
        "한국경제": ["한국경제", "한경", "hankyung", "hankyung.com", "한경닷컴"],
        "매일경제": ["매일경제", "매경", "mk", "mk.co.kr"],
        "연합뉴스": ["연합뉴스", "yna", "yna.co.kr"],
        "파이낸셜뉴스": ["파이낸셜뉴스", "fnnews", "fnnews.com"],
        "데일리팜": ["데일리팜", "dailypharm", "dailypharm.com"],
        "IT조선": ["it조선", "it.chosun.com", "itchosun"],
        "머니투데이": ["머니투데이", "mt", "mt.co.kr"],
        "비즈니스포스트": ["비즈니스포스트", "businesspost", "businesspost.co.kr"],
        "이데일리": ["이데일리", "edaily.co.kr"],
        "아시아경제": ["아시아경제", "asiae", "asiae.co.kr"],
        "뉴스핌": ["뉴스핌", "newspim", "newspim.com"],
        "뉴시스": ["뉴시스", "newsis", "newsis.com"],
        "헤럴드경제": ["헤럴드경제", "herald", "heraldcorp", "heraldcorp.com"],
        "더벨": ["더벨", "thebell", "thebell.co.kr"]
    },
    "Financial": {
        "조선일보": ["조선일보", "chosun", "chosun.com"],
        "중앙일보": ["중앙일보", "joongang", "joongang.co.kr", "joins.com"],
        "동아일보": ["동아일보", "donga", "donga.com"],
        "조선비즈": ["조선비즈", "chosunbiz", "biz.chosun.com"],
        "매거진한경": ["매거진한경", "magazine.hankyung", "magazine.hankyung.com"],
        "한국경제": ["한국경제", "한경", "hankyung", "hankyung.com", "한경닷컴"],
        "매일경제": ["매일경제", "매경", "mk", "mk.co.kr"],
        "연합뉴스": ["연합뉴스", "yna", "yna.co.kr"],
        "파이낸셜뉴스": ["파이낸셜뉴스", "fnnews", "fnnews.com"],
        "데일리팜": ["데일리팜", "dailypharm", "dailypharm.com"],
        "IT조선": ["it조선", "it.chosun.com", "itchosun"],
        "머니투데이": ["머니투데이", "mt", "mt.co.kr"],
        "비즈니스포스트": ["비즈니스포스트", "businesspost", "businesspost.co.kr"],
        "이데일리": ["이데일리", "edaily.co.kr"],
        "아시아경제": ["아시아경제", "asiae", "asiae.co.kr"],
        "뉴스핌": ["뉴스핌", "newspim", "newspim.com"],
        "뉴시스": ["뉴시스", "newsis", "newsis.com"],
        "헤럴드경제": ["헤럴드경제", "herald", "heraldcorp", "heraldcorp.com"],
        "더벨": ["더벨", "thebell", "thebell.co.kr"],
        "SBS": ["SBS", "SBS Biz", "SBSBiz", "SBS뉴스", "sbs", "sbs.co.kr"],
        "MBC": ["MBC", "mbc", "mbc.co.kr", "MBC뉴스", "mbcnews"],
        "KBS": ["KBS", "kbs", "kbs.co.kr", "KBS뉴스", "kbsnews"],
        "딜사이트" : ["딜사이트", "DealSite", "dealsite", "dealsite.co.kr"],
        "딜사이트경제TV" : ["딜사이트경제TV", "DealSite경제TV", "dealsite.economictv", "dealsite.economictv.co.kr"],
        "한국금융경제신문" : ["한국금융경제신문", "한국금융경제신문", "kfn.economictv", "kfn.economictv.co.kr"],
        "조세일보" : ["조세일보","joseilbo.com"]
    }
}

# 하위 호환성을 위한 기존 TRUSTED_PRESS_ALIASES (Corporate 카테고리 사용)
TRUSTED_PRESS_ALIASES = TRUSTED_PRESS_ALIASES_BY_CATEGORY["Corporate"]

def get_trusted_press_aliases_for_category(category):
    """
    카테고리별로 신뢰할 수 있는 언론사 목록을 반환하는 함수
    
    Args:
        category (str): 카테고리명 ("Financial", "Corporate")
    
    Returns:
        dict: 해당 카테고리의 언론사 별칭 딕셔너리
    """
    return TRUSTED_PRESS_ALIASES_BY_CATEGORY.get(category, TRUSTED_PRESS_ALIASES_BY_CATEGORY["Corporate"])

# Additional press aliases for re-evaluation
ADDITIONAL_PRESS_ALIASES = {
    "철강금속신문": ["철강금속신문", "snmnews", "snmnews.com"],
    "에너지신문": ["에너지신문", "energy-news", "energy-news.co.kr"],
    "이코노믹데일리": ["이코노믹데일리", "economidaily", "economidaily.com"]
}

# 카테고리별 제외할 언론사 별칭 설정
# 특정 카테고리에서만 제외해야 하는 언론사의 이름/도메인/별칭을 등록합니다.
EXCLUDED_PRESS_ALIASES_BY_CATEGORY = {
    "Corporate": {},
    "Financial": {
        "딜사이트플러스": ["딜사이트플러스", "DealSitePlus", "dealsiteplus", "dealsiteplus.co.kr"],
        "딜사이트TV플러스": ["딜사이트TV플러스", "DealSiteTVPlus", "dealtvplus", "dealtv.co.kr", "www.dealtv.co.kr"]
    }
}

def get_excluded_press_aliases_for_category(category):
    """
    카테고리별로 제외할 언론사 별칭 딕셔너리를 반환하는 함수

    Args:
        category (str): 카테고리명 ("Financial", "Corporate")

    Returns:
        dict: 해당 카테고리에서 제외할 언론사 별칭 딕셔너리
    """
    return EXCLUDED_PRESS_ALIASES_BY_CATEGORY.get(category, {})

# 회사별 최대 기사 수 설정
# 각 회사별로 AI가 최종 선정할 최대 기사 수를 개별적으로 설정 가능
# 새로운 회사 추가 시: "회사명": 최대기사수 형태로 추가
# 설정되지 않은 회사는 DEFAULT_MAX_ARTICLES(4) 사용
MAX_ARTICLES_BY_COMPANY = {
    # Corporate - Anchor
    "포스코": 4,
    "삼성": 4,
    "SK": 4,
    "현대차": 4,
    "LG": 4,
    "롯데": 4,
    "한화": 4,
    
    # Corporate - Growth_Whitespace
    "CJ": 3,
    "HD현대": 3,
    "신세계": 3,
    "GS": 3,
    "LS": 3,
    
    # Financial - 금융지주
    "KB금융": 4,
    "하나금융": 4,
    "신한금융": 4,
    "우리금융": 4,
    "NH금융": 4,
    "새마을금고등": 4,
    "지방은행(iM금융 포함) 및 비은행 금융지주": 4,
    "기타": 4,
    
    # Financial - 비지주금융그룹
    "삼성(금융)": 5,
    "한화(금융)": 5,
    "현대차(금융)": 5,
    "기타(미래에셋, 교보, DB, 다우키움)": 5,
    
    # Financial - 핀테크
    "카카오뱅크": 3,
    "토스": 3,
    "케이뱅크": 3,
    "네이버파이낸셜": 3,
    "두나무": 3,
    "트래블월렛": 3
}

# 기본 최대 기사 수 (회사별 설정이 없는 경우 사용)
DEFAULT_MAX_ARTICLES = 4

# 제한 없음 설정을 위한 상수
NO_LIMIT = "제한 없음"

# Rule 기반 키워드 필터링 - 카테고리별 제외할 키워드 목록
EXCLUDED_KEYWORDS_BY_CATEGORY = {
    "Financial": [
        "한투證","한투", "한국투자증권","한화투자증권","한투증","미래에셋證","교보증권","목표가", "목표주가", "신고가", "신저가", "배당", "배당성향", "현금배당", "ADR", "주가", "투자 의견", "애널리스트", "장중", "급등", "전망", "특징주", "특징주 선정", "급등주", "급락주", "거래량", "차트 분석", "수익률"
    ],
    "Corporate": []  # Corporate 카테고리는 키워드 필터링 비활성화
}

# 하위 호환성을 위한 기존 EXCLUDED_KEYWORDS (Financial 카테고리 키워드 사용)
EXCLUDED_KEYWORDS = EXCLUDED_KEYWORDS_BY_CATEGORY["Financial"]

def get_excluded_keywords_for_category(category):
    """
    카테고리별로 제외할 키워드 목록을 반환하는 함수
    
    Args:
        category (str): 카테고리명 ("Financial", "Corporate")
    
    Returns:
        list: 해당 카테고리의 제외 키워드 목록
    """
    return EXCLUDED_KEYWORDS_BY_CATEGORY.get(category, [])

def get_main_category_for_company(company):
    """
    회사명으로부터 해당하는 메인 카테고리를 찾는 함수
    
    Args:
        company (str): 회사명
    
    Returns:
        str: 메인 카테고리명 ("Corporate", "Financial")
    """
    for main_category, sub_categories in COMPANY_CATEGORIES.items():
        for category, companies in sub_categories.items():
            if company in companies:
                return main_category
    return "Corporate"  # 기본값

# ===== 회사별 최대 기사 수 설정 사용법 =====
# 1. 기존 회사의 최대 기사 수 변경:
#    MAX_ARTICLES_BY_COMPANY에서 해당 회사의 값을 수정
#    예: "삼성": 6  # 삼성의 최대 기사 수를 6개로 변경
#
# 2. 새로운 회사 추가:
#    MAX_ARTICLES_BY_COMPANY에 새 항목 추가
#    예: "네이버": 3  # 네이버 추가, 최대 3개 기사 선정
#
# 3. 제한 없음 설정:
#    "제한 없음" 문자열 사용 시 AI가 중요도에 따라 모든 기사 선정 가능
#    예: "SK": "제한 없음"  # SK는 기사 수 제한 없이 중요도에 따라 선정
#
# 4. 설정되지 않은 회사:
#    DEFAULT_MAX_ARTICLES 값 사용 (현재 4개)
#
# 5. 카테고리별 일괄 변경이 필요한 경우:
#    MAX_ARTICLES_BY_CATEGORY 사용 (하위 호환성용)
# ============================================

# 카테고리별 최대 기사 수 설정 (하위 호환성을 위해 유지, 새 코드에서는 MAX_ARTICLES_BY_COMPANY 사용 권장)
MAX_ARTICLES_BY_CATEGORY = {
    "Anchor": 4,
    "Growth_Whitespace": 3,
    "금융지주": 4,
    "비지주금융그룹": 5,
    "핀테크": 3
}

# System prompts
SYSTEM_PROMPT_1 = """당신은 회계법인의 뉴스 분석 전문가입니다. 뉴스의 중요성을 판단하여 제외/보류/유지로 분류하는 작업을 수행합니다. 특히 회계법인의 관점에서 중요하지 않은 뉴스(예: 단순 홍보, CSR 활동, 이벤트 등)를 식별하고, 회계 감리나 재무 관련 이슈는 최대한 유지하도록 합니다."""

SYSTEM_PROMPT_2 = """당신은 뉴스 분석 전문가입니다. 유사한 뉴스를 그룹화하고 대표성을 갖춘 기사를 선택하는 작업을 수행합니다. 같은 사안에 대해 숫자, 기업 ,계열사, 맥락, 주요 키워드 등이 유사하면 중복으로 판단합니다. 언론사의 신뢰도와 기사의 상세도를 고려하여 대표 기사를 선정합니다."""

# SYSTEM_PROMPT_3은 이제 함수로 생성됩니다 (get_system_prompt_3 함수 참조)
SYSTEM_PROMPT_3_BASE = """당신은 회계법인의 전문 애널리스트입니다. 뉴스의 중요도를 평가하고 최종 선정하는 작업을 수행합니다. 특히 회계 감리, 재무제표, 경영권 변동, 주요 계약, 법적 분쟁 등 회계법인의 관점에서 중요한 이슈를 식별하고, 그 중요도를 '상' 또는 '중'으로 평가하여 최대 {max_articles}개 기사를 선별합니다. 또한 각 뉴스의 핵심 키워드와 관련 계열사를 식별하여 보고합니다."""

# 제한 없음일 때 사용하는 시스템 프롬프트
SYSTEM_PROMPT_3_NO_LIMIT = """당신은 회계법인의 전문 애널리스트입니다. 뉴스의 중요도를 평가하고 최종 선정하는 작업을 수행합니다. 특히 회계 감리, 재무제표, 경영권 변동, 주요 계약, 법적 분쟁 등 회계법인의 관점에서 중요한 이슈를 식별하고, 그 중요도를 '상' 또는 '중'으로 평가하여 중요도에 따라 필요한 만큼 기사를 선별합니다. 기사 수에 제한이 없으므로 회계법인 관점에서 가치가 있는 모든 뉴스를 포함하시기 바랍니다. 또한 각 뉴스의 핵심 키워드와 관련 계열사를 식별하여 보고합니다."""

def get_system_prompt_3(company):
    """
    회사별로 동적으로 SYSTEM_PROMPT_3를 생성하는 함수
    
    Args:
        company (str): 회사명 (삼성, SK, KB금융, 카카오뱅크 등)
    
    Returns:
        str: 해당 회사에 맞는 SYSTEM_PROMPT_3
    """
    max_articles = MAX_ARTICLES_BY_COMPANY.get(company, DEFAULT_MAX_ARTICLES)  # 회사별 설정 또는 기본값
    
    # "제한 없음"인 경우 특별한 프롬프트 사용
    if max_articles == NO_LIMIT:
        return SYSTEM_PROMPT_3_NO_LIMIT
    else:
        return SYSTEM_PROMPT_3_BASE.format(max_articles=max_articles)

def get_system_prompt_3_by_category(category):
    """
    카테고리별로 동적으로 SYSTEM_PROMPT_3를 생성하는 함수 (하위 호환성용)
    
    Args:
        category (str): 카테고리명 (Anchor, Growth_Whitespace, 금융지주, 핀테크)
    
    Returns:
        str: 해당 카테고리에 맞는 SYSTEM_PROMPT_3
    """
    max_articles = MAX_ARTICLES_BY_CATEGORY.get(category, DEFAULT_MAX_ARTICLES)  # 기본값
    return SYSTEM_PROMPT_3_BASE.format(max_articles=max_articles)

def get_max_articles_for_company(company):
    """
    회사별 최대 기사 수를 반환하는 유틸리티 함수
    
    Args:
        company (str): 회사명
    
    Returns:
        int 또는 str: 해당 회사의 최대 기사 수 (설정이 없으면 DEFAULT_MAX_ARTICLES 반환)
                     "제한 없음"인 경우 NO_LIMIT 문자열 반환
    """
    return MAX_ARTICLES_BY_COMPANY.get(company, DEFAULT_MAX_ARTICLES)

# Criteria definitions
EXCLUSION_CRITERIA = """

🚫 회계법인 관점 뉴스 제외 기준
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📍 1단계: 기업 연관성 검증
────────────────────────────────────────────────────────────
• 제목에 해당 기업명이나 관련 키워드가 포함되지 않은 기사는 무조건 제외
• 각 회사별 키워드 목록은 COMPANY_KEYWORD_MAP 참조

📍 2단계: 키워드회사의 다른회사에 대한 의견기사는 무조건 제외
────────────────────────────────────────────────────────────
• 키워드회사가 다른 회사에 대한 의견을 제시하는 기사는 제외
• 패턴: "[키워드회사명] '기업명 의견제시'" → 제외
<예시>
[키워드-키움증권] 키움증권 "달바글로벌 높은 해외 성장률, 글로벌 프리미엄 포지셔닝 강화" → 달바글로벌에 대한 의견제시이므로 제외
[키워드-한국투자] 한국투자 'HD현대일렉트릭 목표주가 상향, 미국 초고압변압기 수출 증가로 실적 개선' → HD현대일렉트릭에 대한 의견제시이므로 제외
[키워드-교보증권] 오리온 6월 매출 성장률 둔화, 교보증권 "하반기 추경과 신제품 출시 기대" → 오리온에 대한 의견제시이므로 제외
[키워드-NH] 기업은행, 2Q 실적 양호…건전성 부담은 확대-NH → 기업은행에 대한 의견제시이므로 제외

📍 3단계: 카테고리별 제외 기준
────────────────────────────────────────────────────────────

🏆 A그룹: 완전 제외 (예외 없음)
   1. 스포츠/엔터테인먼트 관련
      키워드: 야구단, 축구단, 구단, KBO, 프로야구, 감독, 선수, 스포츠, 연예인, 광고모델, 후원
      → 사업적 맥락과 무관한 순수 오락/스포츠 활동
      
   2. 단순 마케팅/브랜드 홍보
      키워드: 브랜드 홍보, 광고 캠페인, 소비자 이벤트, 프로모션, 할인행사
      → 일시적 마케팅 활동으로 사업 구조에 영향 없음
      
   3. 일반 인사/내부 운영
      키워드: 일반직원 채용, 사내 포상, 직원 교육, 워크샵, 조직문화, 복지
      → 단, C-level 이상 경영진 인사는 예외
      
   4. 신고가 관련
      키워드: 신고가 경신, 신고가 달성, 신고가 상향, 신고가 하향
      판단기준:
      - 무조건 제외 (회계법인 업무와 무관)

📊 B그룹: 맥락적 제외 (사업 연관성 기준)
   1. CSR/사회공헌/ESG 활동
      키워드: 기부, 환경 캠페인, 사회공헌, 나눔, 캠페인 진행, 봉사활동
      판단기준:
      - 단순 일회성 기부나 이벤트: 제외
      - 사업전략과 연계된 ESG 경영: 보류
      - 탄소중립, RE100 등 사업모델 변화 수반: 유지
      
   2. 신제품/서비스 관련
      키워드: 출시, 론칭, 신제품, 신서비스, 제품 개선
      판단기준:
      - 기존 제품라인 연장: 제외
      - 신사업 진출이나 시장 확장: 보류
      - 사업구조나 수익모델 변화: 유지

📈 C그룹: 내용 중심 제외 (실질적 영향 기준)
   1. 기술 성능/품질 관련
      키워드: 우수성 입증, 기술력 인정, 성능 비교, 품질 테스트, 기술 성과, 인증 획득
      판단기준:
      - 단순 성능 홍보나 마케팅: 제외
      - 경쟁력 변화나 시장지위 영향: 보류
      - 신기술 상용화나 사업 모델 변화: 유지
      
   2. 시스템/서비스 운영 이슈
      키워드: 일시 중단, 접속 오류, 서비스 오류, 버그, 점검 중, 업데이트 실패
      판단기준:
      - 일반적인 점검이나 단순 오류: 제외
      - 고객 영향이 크거나 반복적 문제: 보류
      - 보안사고, 대규모 장애, 시스템 마비: 유지

📉 D그룹: 정보성 뉴스 제외 (분석 가치 기준)
      
   2. 순위/비교성 보도
      키워드: 평균 연봉, 브랜드 가치 순위, 기업 순위, 만족도 조사, 순위 변동 원인 분석, 경쟁력이나 시장지위 변화 시사
      판단기준:
      - 무조건 제외 (회계법인 업무와 무관)
      
   3. 주식시장 기술적 분석
      키워드: 특징주, 특징주 선정, 급등주, 급락주, 거래량, 차트 분석
      → 무조건 제외 (회계법인 업무와 무관)
      
   4. 부동산 관련 (비핵심)
      키워드: 재건축, 재건축 계획, 부동산 개발, 토지 매입
      판단기준:
      - 일반 부동산 투자: 제외
      - 사업 확장이나 구조조정과 연관: 보류
      - 본사 이전이나 대규모 사업부지: 유지

🔍 E그룹: 무의미한 표현 제외
   키워드: 오전 이슈, 호재, 악재, 시장 관심, 투자자 주목
   → 구체적 사실 없이 추상적 표현만 있는 경우 제외

📍 4단계: 절대 유지 기준 (제외 기준 무시)
────────────────────────────────────────────────────────────

💼 회계법인 핵심 관심사:
• 재무제표, 실적 발표, 감사 관련 → 무조건 유지
• 회계처리 변경, 감사의견 → 무조건 유지
• 내부회계관리제도 → 무조건 유지

🏢 기업구조 변화:
• M&A, 인수합병, 지분 변동 → 무조건 유지
• 자회사 설립/매각, 사업부 분할 → 무조건 유지
• 조직 개편, 계열사 구조조정 → 무조건 유지

👔 경영진 변화:
• 대표이사, 회장, 부회장 등 최고경영진 → 무조건 유지
• 임원진 대규모 교체 → 무조건 유지
• 경영권 분쟁, 승계 이슈 → 무조건 유지

⚖️ 규제/법적 이슈:
• 정부 정책의 직접적 사업 영향 → 무조건 유지
• 법적 분쟁, 소송, 규제 조치 → 무조건 유지
• 업계 규제 변화의 특정 기업 영향 → 무조건 유지

📍 5단계: 최종 판단 가이드라인
────────────────────────────────────────────────────────────

🎯 핵심 질문:
1. "이 뉴스가 기업의 재무적 성과에 영향을 줄 가능성이 있는가?"
2. "회계법인이 클라이언트에게 전달할 가치가 있는 정보인가?"
3. "기업 가치나 사업 전략의 변화를 시사하는가?"

🔄 맥락적 판단 원칙:
• 같은 키워드라도 맥락에 따라 다르게 판단
• 기업 규모와 업종 특성 고려
• 시장 상황과 타이밍 고려
• 회계법인 클라이언트의 관심도 고려

✅ 유지 예시:
- "삼성전자, 3분기 영업이익 전년대비 50% 증가"
- "현대차, 인도 시장 진출을 위한 현지 합작회사 설립"
- "KB금융, 디지털 뱅킹 강화 위해 핀테크 회사 인수"

❓ 보류 예시 (맥락 검토):
- "LG화학, 글로벌 배터리 안전성 1위 인증" → 경쟁력 관련성 검토
- "신한금융, 탄소중립 달성 목표 발표" → ESG 경영전략 연관성 검토

❌ 제외 예시:
- "롯데자이언츠, 2024시즌 감독 선임식 개최"
- "SK텔레콤, 고객 감사 이벤트 진행"
- "삼성전자 주가, 장중 52주 신고가 경신"

"""

# 카테고리별 제외 기준 설정
EXCLUSION_CRITERIA_BY_CATEGORY = {
    "Corporate": EXCLUSION_CRITERIA,  # Corporate는 기존 기준 그대로 사용
    "Financial": """

🚫 회계법인 관점 뉴스 제외 기준 (Financial 카테고리)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📍 1단계: 기업 연관성 검증
────────────────────────────────────────────────────────────
• 제목에 해당 기업명이나 관련 키워드가 포함되지 않은 기사는 무조건 제외
• 각 회사별 키워드 목록은 COMPANY_KEYWORD_MAP 참조

📍 2단계: 키워드회사의 다른회사에 대한 의견기사는 무조건 제외
────────────────────────────────────────────────────────────
• 키워드회사가 다른 회사에 대한 의견을 제시하는 기사는 제외
• 패턴: "[키워드회사명] '기업명 의견제시'" → 제외
<예시>
[키워드-키움증권] 키움증권 "달바글로벌 높은 해외 성장률, 글로벌 프리미엄 포지셔닝 강화" → 달바글로벌에 대한 의견제시이므로 제외
[키워드-한국투자] 한국투자 'HD현대일렉트릭 목표주가 상향, 미국 초고압변압기 수출 증가로 실적 개선' → HD현대일렉트릭에 대한 의견제시이므로 제외
[키워드-교보증권] 오리온 6월 매출 성장률 둔화, 교보증권 "하반기 추경과 신제품 출시 기대" → 오리온에 대한 의견제시이므로 제외
[키워드-NH] 기업은행, 2Q 실적 양호…건전성 부담은 확대-NH → 기업은행에 대한 의견제시이므로 제외

📍 3단계: 카테고리별 제외 기준
────────────────────────────────────────────────────────────

🏆 A그룹: 완전 제외 (예외 없음)
   1. 스포츠/엔터테인먼트 관련
      키워드: 야구단, 축구단, 구단, KBO, 프로야구, 감독, 선수, 스포츠, 연예인, 광고모델, 후원
      → 사업적 맥락과 무관한 순수 오락/스포츠 활동
      
   2. 단순 마케팅/브랜드 홍보
      키워드: 브랜드 홍보, 광고 캠페인, 소비자 이벤트, 프로모션, 할인행사
      → 일시적 마케팅 활동으로 사업 구조에 영향 없음
      
   3. 신고가 관련
      키워드: 신고가 경신, 신고가 달성, 신고가 상향, 신고가 하향
      판단기준:
      - 무조건 제외 (회계법인 업무와 무관)
    
    4. 주식시장 관련
      키워드: 주가, 투자 의견, 애널리스트, 목표가, 장중, 급등, 전망, 특징주, 특징주 선정, 급등주, 급락주, 거래량, 차트 분석
      판단기준:
      - 무조건 제외 (회계법인 업무와 무관)

📊 B그룹: 맥락적 제외 (사업 연관성 기준)
   1. CSR/사회공헌/ESG 활동
      키워드: 기부, 환경 캠페인, 사회공헌, 나눔, 캠페인 진행, 봉사활동
      판단기준:
      - 단순 일회성 기부나 이벤트: 제외
      - 사업전략과 연계된 ESG 경영: 보류
      - 탄소중립, RE100 등 사업모델 변화 수반: 유지
      
   2. 신제품/서비스 관련
      키워드: 출시, 론칭, 신제품, 신서비스, 제품 개선
      판단기준:
      - 기존 제품라인 연장: 제외
      - 신사업 진출이나 시장 확장: 보류
      - 사업구조나 수익모델 변화: 유지

📈 C그룹: 내용 중심 제외 (실질적 영향 기준)
   1. 기술 성능/품질 관련
      키워드: 우수성 입증, 기술력 인정, 성능 비교, 품질 테스트, 기술 성과, 인증 획득
      판단기준:
      - 단순 성능 홍보나 마케팅: 제외
      - 경쟁력 변화나 시장지위 영향: 보류
      - 신기술 상용화나 사업 모델 변화: 유지
      
   2. 시스템/서비스 운영 이슈
      키워드: 일시 중단, 접속 오류, 서비스 오류, 버그, 점검 중, 업데이트 실패
      판단기준:
      - 일반적인 점검이나 단순 오류: 제외
      - 고객 영향이 크거나 반복적 문제: 보류
      - 보안사고, 대규모 장애, 시스템 마비: 유지

📉 D그룹: 정보성 뉴스 제외 (분석 가치 기준)
      
   2. 순위/비교성 보도
      키워드: 평균 연봉, 브랜드 가치 순위, 기업 순위, 만족도 조사, 순위 변동 원인 분석, 경쟁력이나 시장지위 변화 시사
      판단기준:
      - 무조건 제외 (회계법인 업무와 무관)
      
   3. 주식시장 기술적 분석
      키워드: 특징주, 특징주 선정, 급등주, 급락주, 거래량, 차트 분석
      → 무조건 제외 (회계법인 업무와 무관)
      
   4. 부동산 관련 (비핵심)
      키워드: 재건축, 재건축 계획, 부동산 개발, 토지 매입
      판단기준:
      - 일반 부동산 투자: 제외
      - 사업 확장이나 구조조정과 연관: 보류
      - 본사 이전이나 대규모 사업부지: 유지

🔍 E그룹: 무의미한 표현 제외
   키워드: 오전 이슈, 호재, 악재, 시장 관심, 투자자 주목
   → 구체적 사실 없이 추상적 표현만 있는 경우 제외

📍 4단계: 절대 유지 기준 (제외 기준 무시)
────────────────────────────────────────────────────────────

💼 회계법인 핵심 관심사:
• 재무제표, 실적 발표, 감사 관련 → 무조건 유지
• 회계처리 변경, 감사의견 → 무조건 유지
• 내부회계관리제도 → 무조건 유지

🏢 기업구조 변화:
• M&A, 인수합병, 지분 변동 → 무조건 유지
• 자회사 설립/매각, 사업부 분할 → 무조건 유지
• 조직 개편, 계열사 구조조정 → 무조건 유지

👔 경영진 변화:
• 대표이사, 회장, 부회장 등 최고경영진 → 무조건 유지
• 임원진 대규모 교체 → 무조건 유지
• 경영권 분쟁, 승계 이슈 → 무조건 유지

⚖️ 규제/법적 이슈:
• 정부 정책의 직접적 사업 영향 → 무조건 유지
• 법적 분쟁, 소송, 규제 조치 → 무조건 유지
• 업계 규제 변화의 특정 기업 영향 → 무조건 유지

📍 5단계: 최종 판단 가이드라인
────────────────────────────────────────────────────────────

🎯 핵심 질문:
1. "이 뉴스가 기업의 재무적 성과에 영향을 줄 가능성이 있는가?"
2. "회계법인이 클라이언트에게 전달할 가치가 있는 정보인가?"
3. "기업 가치나 사업 전략의 변화를 시사하는가?"

🔄 맥락적 판단 원칙:
• 같은 키워드라도 맥락에 따라 다르게 판단
• 기업 규모와 업종 특성 고려
• 시장 상황과 타이밍 고려
• 회계법인 클라이언트의 관심도 고려

✅ 유지 예시:
- "삼성전자, 3분기 영업이익 전년대비 50% 증가"
- "현대차, 인도 시장 진출을 위한 현지 합작회사 설립"
- "KB금융, 디지털 뱅킹 강화 위해 핀테크 회사 인수"

❓ 보류 예시 (맥락 검토):
- "LG화학, 글로벌 배터리 안전성 1위 인증" → 경쟁력 관련성 검토
- "신한금융, 탄소중립 달성 목표 발표" → ESG 경영전략 연관성 검토

❌ 제외 예시:
- "롯데자이언츠, 2024시즌 감독 선임식 개최"
- "SK텔레콤, 고객 감사 이벤트 진행"
- "삼성전자 주가, 장중 52주 신고가 경신"

"""
}

def get_exclusion_criteria_for_category(category):
    """
    카테고리별로 제외 기준을 반환하는 함수
    
    Args:
        category (str): 카테고리명 ("Financial", "Corporate")
    
    Returns:
        str: 해당 카테고리의 제외 기준
    """
    return EXCLUSION_CRITERIA_BY_CATEGORY.get(category, EXCLUSION_CRITERIA)

DUPLICATE_HANDLING = """중복 뉴스가 존재할 경우 다음 우선순위로 1개만 선택하십시오:
1. 언론사 우선순위 (높은 순위부터)
   - 1순위: 경제 전문지 (한국경제, 매일경제, 조선비즈, 파이낸셜뉴스)
   - 2순위: 종합 일간지 (조선일보, 중앙일보, 동아일보)
   - 3순위: 통신사 (연합뉴스, 뉴스핌, 뉴시스)
   - 4순위: 기타 언론사

2. 발행 시간 (같은 언론사 내에서)
   - 최신 기사 우선
   - 정확한 시간 정보가 없는 경우, 날짜만 비교

3. 기사 내용의 완성도
   - 더 자세한 정보를 포함한 기사 우선
   - 주요 인용문이나 전문가 의견이 포함된 기사 우선
   - 단순 보도보다 분석적 내용이 포함된 기사 우선

4. 제목의 명확성
   - 더 구체적이고 명확한 제목의 기사 우선
   - 핵심 키워드가 포함된 제목 우선"""

SELECTION_CRITERIA = """다음 기준에 해당하는 뉴스가 있다면 반드시 선택해야 합니다:

1. 재무/실적 관련 정보 (최우선 순위)
   - 매출, 영업이익, 순이익 등 실적 발표
   - 재무제표 관련 정보
   - 배당 정책 변경

2. 회계/감사 관련 정보 (최우선 순위)
   - 회계처리 방식 변경
   - 감사의견 관련 내용
   - 내부회계관리제도
   - 회계 감리 결과
   
3. 구조적 기업가치 변동 정보 (높은 우선순위)
    - 신규사업/투자/계약에 대한 내용
    - 대외 전략(정부 정책, 글로벌 파트너, 지정학 리스크 등)
    - 기업의 새로운 사업전략 및 방향성, 신사업 등
    - 기업의 전략 방향성에 영향을 미칠 수 있는 정보
    - 기존 수입모델/사업구조/고객구조 변화
    - 공급망/수요망 등 valuechain 관련 내용 (예: 대형 생산지 이전, 주력 사업군 정리 등) 

4. 기업구조 변경 정보 (높은 우선순위)
   - 인수합병(M&A)
   - 자회사 설립/매각
   - 지분 변동
   - 조직 개편

5. 최종 검증 (필수 확인사항) 🔍
   위 기준에 해당하는 뉴스라도 제목에 해당 기업명이나 관련 키워드가 포함되지 않은 기사는 제외
   • 각 회사별 키워드 목록은 COMPANY_KEYWORD_MAP 참조
   1) 제목과 내용에 해당 기업명이나 관련 키워드가 명확히 포함되어 있는가?
   2) 해당 기업이 기사의 주요 대상인가?
   3) 제목에서 해당 기업이 주어/주체로 언급되는가?
   4) 기업이 다른 회사에 대한 투자의견을 제시하는 기사는 아닌가?
    - 제외 기사 예시
    [키워드-키움증권] 키움증권 "달바글로벌 높은 해외 성장률, 글로벌 프리미엄 포지셔닝 강화" → 달바글로벌에 대한 의견제시이므로 제외
    [키워드-한국투자] 한국투자 'HD현대일렉트릭 목표주가 상향, 미국 초고압변압기 수출 증가로 실적 개선' → HD현대일렉트릭에 대한 의견제시이므로 제외
    [키워드-교보증권] 오리온 6월 매출 성장률 둔화, 교보증권 "하반기 추경과 신제품 출시 기대" → 오리온에 대한 의견제시이므로 제외
    [키워드-NH] 기업은행, 2Q 실적 양호…건전성 부담은 확대-NH → 기업은행에 대한 의견제시이므로 제외"""
    
# GPT Model options
GPT_MODELS = {
    "openai.gpt-4.1-2025-04-14" : "chatpwc",#pwc
    "gpt-4.1": "최신모델",
    "gpt-4o": "빠르고 실시간, 멀티모달 지원",
    "gpt-4-turbo": "최고 성능, 비용은 좀 있음",
    "gpt-4.1-mini": "성능 높고 비용 저렴, 정밀한 분류·요약에 유리",
    "gpt-4.1-nano": "초고속·초저가, 단순 태그 분류에 적합",
    "gpt-3.5-turbo": "아주 저렴, 간단한 분류 작업에 적당"
}

# Default GPT model to use
#DEFAULT_GPT_MODEL = "gpt-4.1"
DEFAULT_GPT_MODEL = "gpt-4.1" 

# Email settings
EMAIL_SETTINGS = {
    "from": "kr_client_and_market@pwc.com", #from #kr_client_and_market@pwc.com"
    "default_to": "youngin.kang@pwc.com",
    "default_cc": "youngin.kang@pwc.com",
    "default_bcc": "",  # 기본 bcc 설정
    "default_subject": "Client Intelligence",
    "importance": "Normal"
}

# 카테고리별 이메일 설정
EMAIL_SETTINGS_BY_CATEGORY = {
    "Corporate": {
        "to": "youngin.kang@pwc.com",  # Corporate 카테고리 수신자
        "cc": "youngin.kang@pwc.com",  # Corporate 카테고리 참조
        "bcc": "youngin.kang@pwc.com",  # Corporate 카테고리 숨은 참조
        "subject_prefix": "Corporate"
    },
    "Financial": {
        "to": "youngin.kang@pwc.com",  # Financial 카테고리 수신자
        "cc": "youngin.kang@pwc.com",  # Financial 카테고리 참조
        "bcc": "",  # Financial 카테고리 숨은 참조
        "subject_prefix": "Financial"
    }
}

# Teams settings
TEAMS_SETTINGS = {
    "enabled": True,
    "title": "[PwC] 뉴스 분석 보고서",
    "subtitle": "AI가 선별한 오늘의 주요 뉴스",
    "use_plain_text": True  # False면 HTML 사용, True면 텍스트 사용
}

# Teams 채널별 설정 (카테고리별) - 새 구조에 맞게 비활성화
TEAMS_CHANNEL_SETTINGS = {
    "Corporate": {
        "groupId": "",  # Corporate 팀 그룹 ID (비활성화)
        "channels": {}  # 새 구조에서는 일단 비활성화
    },
    "Financial": {
        "groupId": "",  # Financial 팀 그룹 ID (비활성화)
        "channels": {}  # 새 구조에서는 일단 비활성화
    }
}

# SharePoint List 설정 (카테고리별 -> 회사별) - 새 구조에 맞게 업데이트
SHAREPOINT_LIST_SETTINGS = {
    "Corporate": {
        "enabled": True,
        "companies": {
            # Anchor 섹션
            "삼성": {
                "site_url": "",  # SharePoint 사이트 URL (예: https://company.sharepoint.com/sites/news)
                "list_id": "",   # SharePoint List ID
                "column_ids": {
                    "month": "",     # Month 컬럼 ID
                    "date": "",      # 날짜 컬럼 ID
                    "title": "",     # 제목 컬럼 ID
                    "link": ""       # 링크 컬럼 ID
                }
            },
            "SK": {
                "site_url": "", #https://pwckor.sharepoint.com/teams/KR-INT-xLoS-SK-GSP-/
                "list_id": "", #ec97b948-d61e-47b7-9f1c-45bf62c46ec3
                "column_ids": {
                    "month": "",  #Month
                    "date": "", #OData__xb0a0__xc9dc_
                    "title": "", #Title
                    "link": "" #OData__xb9c1__xd06c_
                }
            },
            # 기타 Corporate 회사들은 비활성화
            "LG": {"site_url": "", "list_id": "", "column_ids": {"month": "", "date": "", "title": "", "link": ""}},
            "현대차": {"site_url": "", "list_id": "", "column_ids": {"month": "", "date": "", "title": "", "link": ""}},
            "롯데": {"site_url": "", "list_id": "", "column_ids": {"month": "", "date": "", "title": "", "link": ""}},
            "한화": {"site_url": "", "list_id": "", "column_ids": {"month": "", "date": "", "title": "", "link": ""}},
            "포스코": {"site_url": "", "list_id": "", "column_ids": {"month": "", "date": "", "title": "", "link": ""}},
            # Growth_Whitespace 섹션
            "HD현대": {"site_url": "", "list_id": "", "column_ids": {"month": "", "date": "", "title": "", "link": ""}},
            "신세계": {"site_url": "", "list_id": "", "column_ids": {"month": "", "date": "", "title": "", "link": ""}},
            "GS": {"site_url": "", "list_id": "", "column_ids": {"month": "", "date": "", "title": "", "link": ""}},
            "LS": {"site_url": "", "list_id": "", "column_ids": {"month": "", "date": "", "title": "", "link": ""}},
            "CJ": {"site_url": "", "list_id": "", "column_ids": {"month": "", "date": "", "title": "", "link": ""}}
        }
    },
    "Financial": {
        "enabled": True,
        "companies": {
            # 시중은행행 섹션
            "KB금융": {"site_url": "", "list_id": "", "column_ids": {"month": "", "date": "", "title": "", "link": ""}},
            "신한금융": {"site_url": "", "list_id": "", "column_ids": {"month": "", "date": "", "title": "", "link": ""}},
            "우리금융": {"site_url": "", "list_id": "", "column_ids": {"month": "", "date": "", "title": "", "link": ""}},
            "하나금융": {"site_url": "", "list_id": "", "column_ids": {"month": "", "date": "", "title": "", "link": ""}},
            "NH금융": {"site_url": "", "list_id": "", "column_ids": {"month": "", "date": "", "title": "", "link": ""}},
            "새마을금고등": {"site_url": "", "list_id": "", "column_ids": {"month": "", "date": "", "title": "", "link": ""}},
            "지방은행(iM금융 포함) 및 비은행 금융지주": {"site_url": "", "list_id": "", "column_ids": {"month": "", "date": "", "title": "", "link": ""}},
            # 비지주금융그룹 섹션
            "삼성(금융)": {"site_url": "", "list_id": "", "column_ids": {"month": "", "date": "", "title": "", "link": ""}},
            "한화(금융)": {"site_url": "", "list_id": "", "column_ids": {"month": "", "date": "", "title": "", "link": ""}},
            "현대차(금융)": {"site_url": "", "list_id": "", "column_ids": {"month": "", "date": "", "title": "", "link": ""}},
            "기타(미래에셋, 교보, DB, 다우키움)": {"site_url": "", "list_id": "", "column_ids": {"month": "", "date": "", "title": "", "link": ""}},
            # 핀테크 섹션
            "카카오뱅크": {"site_url": "", "list_id": "", "column_ids": {"month": "", "date": "", "title": "", "link": ""}},
            "토스": {"site_url": "", "list_id": "", "column_ids": {"month": "", "date": "", "title": "", "link": ""}},
            "케이뱅크": {"site_url": "", "list_id": "", "column_ids": {"month": "", "date": "", "title": "", "link": ""}},
            "네이버파이낸셜": {"site_url": "", "list_id": "", "column_ids": {"month": "", "date": "", "title": "", "link": ""}},
            "두나무": {"site_url": "", "list_id": "", "column_ids": {"month": "", "date": "", "title": "", "link": ""}},
            "트래블월렛": {"site_url": "", "list_id": "", "column_ids": {"month": "", "date": "", "title": "", "link": ""}}
        }
    }
}

# API endpoint for email - 환경변수에서 가져옴
# EMAIL_API_ENDPOINT는 환경변수 EMAIL_API_ENDPOINT 또는 POWERAUTOMATE_WEBHOOK_URL에서 가져옵니다 

# Company-specific additional criteria for each AI stage
# 1단계: 제외 판단 추가 기준
COMPANY_ADDITIONAL_EXCLUSION_CRITERIA = {
    "현대차": """
────────────────────────────────────────────────────────────    
** 현대차그룹 특화 제외 기준: 하기 키워드 무조건 제외
1) 노사 갈등 및 임단협 관련 보도
- 키워드: 현대차證""",
    "롯데": """
────────────────────────────────────────────────────────────    
** 롯데그룹 특화 제외 기준: 하기 키워드 무조건 제외
- 키워드: 롯데카드, 롯데손보, 롯데손해보험"""
}

# 2단계: 그룹핑 추가 기준
COMPANY_ADDITIONAL_DUPLICATE_HANDLING = {
}

# 3단계: 선택 기준 추가
COMPANY_ADDITIONAL_SELECTION_CRITERIA = {
    "CJ": """

5. CJ그룹(CJ제일제당, CJ대한통운, CJ ENM 등) 특화 기준 (위 기준 3, 4에 추가 해당)
   해당 키워드가 포함되어 있을 경우에도 위 기준 3 또는 4에 해당하므로 반드시 선택합니다:
   - 콘텐츠 전략: 콘텐츠 IP, OTT, 제작비, 콘텐츠 투자, 스튜디오드래곤, CJ ENM 전략
   - 유통/물류 구조: 풀필먼트, 물류센터, 냉장물류, SCM, 글로벌 유통망, CJ대한통운
   - 사업구조 변화: 인적분할, 물적분할, 계열 분할, 자회사 설립, 사업부 분리, 지분 매각""",

    "NH금융": """

5. NH농협금융지주그룹(NH투자증권, NH농협은행 등) 특화 기준 (위 기준 3, 4에 추가 해당)
   해당 키워드가 포함되어 있을 경우에도 위 기준 3 또는 4에 해당하므로 반드시 선택합니다:
   - 금융 디지털화: 스마트팜 금융, 디지털전환, 플랫폼 전략, 모바일뱅킹, 금융앱, AI대출
   - 농협 특수성: 조합원, 상호금융, 농민 금융, 지역 농협, 농업 지원 정책
   - 계열 전략: 계열사 구조, 지주 전략""",

    "우리금융": """

5. 우리금융지주 (우리은행, 우리카드, 우리금융캐피탈 등) 특화 기준 (위 기준 3, 4에 추가 해당)
   해당 키워드가 포함되어 있을 경우에도 위 기준 3 또는 4에 해당하므로 반드시 선택합니다:
   - 지배구조 이슈: 예금보험공사, 공적자금, 지분 매각, 민영화, 최대주주, 지분 구조 변화
   - 경영진 인사: 대표이사, 행장, 회장단, 연임, 경영진 교체, 이사회 구성
   - PF/리스크 이슈: PF대출, 부동산 리스크, 부실채권, 충당금, 건전성, BIS비율""",

    "HD현대": """

5. HD현대 (HD한국조선해양, HD현대중공업, HD현대오일뱅크 등) 특화 기준 (위 기준 3, 4에 추가 해당)
   해당 키워드가 포함되어 있을 경우에도 위 기준 3 또는 4에 해당하므로 반드시 선택합니다:
   - 무인화/자동화 전략: 스마트조선소, 자동용접, 무인운반, 디지털 조선, AI 기반 설계, 로봇공정
   - 친환경/에너지 전환: 암모니아 추진선, 수소엔진, 친환경선박, 탄소중립, 그린수소, 해상풍력, 에너지저장장치(ESS)
   - 글로벌 인프라 전략: 중동 플랜트, 오만 수주, 사우디 프로젝트, 글로벌 조선 수주, 선박 계약""",

    "신한금융": """

5. 신한금융지주 (신한은행, 신한카드, 신한투자증권 등) 특화 기준 (위 기준 3, 4에 추가 해당)
   해당 키워드가 포함되어 있을 경우에도 위 기준 3 또는 4에 해당하므로 반드시 선택합니다:
   - 포트폴리오 재편: 비은행 강화, 카드·증권 통합, 신사업 진출, 핀테크 투자, 디지털 플랫폼화, 디지털 전환 전략
   - 경영 인사 및 지배구조: 차기 회장, 행장 인선, 경영진 재편, 지주사 체제 개편, CEO 리스크, 내부통제 강화
   - 리스크 대응: 금리 민감도, 충당금 적립, 부동산 익스포저""",

    "신세계": """

5. 신세계그룹 특화 기준 (위 기준 3, 4에 추가 해당)
   해당 키워드가 포함되어 있을 경우에도 위 기준 3 또는 4에 해당하므로 반드시 선택합니다:
   - 리테일 전략: 복합몰 전략, 스타필드, 프리미엄 아울렛, 이마트 구조조정, 백화점 실적, 온라인 통합몰
   - 사업구조 변화: 신세계인터내셔날, 지분 매각, 신사업 확장""",

    "GS": """

5. GS그룹 특화 기준 (위 기준 3, 4에 추가 해당)
   해당 키워드가 포함되어 있을 경우에도 위 기준 3 또는 4에 해당하므로 반드시 선택합니다:
   - 에너지 전환: GS에너지, RE100, LNG 인프라, 그린수소, 탄소 포집
   - 리테일 혁신: GS리테일, 편의점 수익, 통합 물류
   - 그룹 구조 개편: 계열사 재편, 미래 성장 포트폴리오""",

    "LS": """

5. LS그룹 특화 기준 (위 기준 3, 4에 추가 해당)
   해당 키워드가 포함되어 있을 경우에도 위 기준 3 또는 4에 해당하므로 반드시 선택합니다:
   - 전력 인프라: 전선사업, 배터리 소재, 전력 인프라, ESS, LS일렉트릭 전략
   - 친환경 소재: 동소재, 전기차 부품, 탄소저감 소재
   - 사업구조 재편: LS엠트론, 계열 분할, 신성장 동력"""
} 

# Relaxed criteria for re-evaluation when no news selected
# 재평가용 완화 기준들

# 3단계: 제외 판단 완화 기준
RELAXED_EXCLUSION_CRITERIA = """

🚫 회계법인 관점 뉴스 제외 기준 (완화판 - 재평가용)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

⚠️ 재평가 완화 지침 ⚠️
• 기준을 엄격하게 적용하지 말고, 조금이라도 회계법인 관점에서 가치가 있는 내용이면 보류 우선
• 반드시 최소 1개 이상의 기사를 선정해야 함
• 애매한 경우 "제외"보다 "보류" 또는 "유지" 우선 선택
• 상대적으로 가장 나은 기사들을 선정하는 관점에서 접근

🚫 회계법인 관점 뉴스 제외 기준
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📍 1단계: 기업 연관성 검증
────────────────────────────────────────────────────────────
• 제목에 해당 기업명이나 관련 키워드가 포함되지 않은 기사는 무조건 제외
• 각 회사별 키워드 목록은 COMPANY_KEYWORD_MAP 참조

📍 2단계: 금융투자의견 제외
────────────────────────────────────────────────────────────

🚨 **키워드가 금융회사/증권사/은행인 경우 금융투자의견 기사 무조건 제외:
• 금융회사/증권사/은행이 다른 회사에 대한 의견을 제시하는 기사는 제외
• 패턴: "[금융회사/증권사/은행명] '기업명 의견제시'" → 제외
• 예시: 키움증권 "달바글로벌 높은 해외 성장률, 글로벌 프리미엄 포지셔닝 강화" → 제외
• 예시: 한국투자 'HD현대일렉트릭 목표주가 상향, 미국 초고압변압기 수출 증가로 실적 개선' → 제외
• 예시: 오리온 6월 매출 성장률 둔화, 교보증권 "하반기 추경과 신제품 출시 기대" → 제외

📍 3단계: 카테고리별 제외 기준 (완화 적용)
────────────────────────────────────────────────────────────

🏆 A그룹: 완전 제외 (예외 없음)
   1. 스포츠/엔터테인먼트 관련
      키워드: 야구단, 축구단, 구단, KBO, 프로야구, 감독, 선수, 스포츠, 연예인, 광고모델, 후원
      → 사업적 맥락과 무관한 순수 오락/스포츠 활동
      
   2. 단순 마케팅/브랜드 홍보
      키워드: 브랜드 홍보, 광고 캠페인, 소비자 이벤트, 프로모션, 할인행사
      → 일시적 마케팅 활동으로 사업 구조에 영향 없음
      
   3. 일반 인사/내부 운영
      키워드: 일반직원 채용, 사내 포상, 직원 교육, 워크샵, 조직문화, 복지
      → 단, C-level 이상 경영진 인사는 예외
      
   4. 신고가 관련
      키워드: 신고가 경신, 신고가 달성, 신고가 상향, 신고가 하향
      판단기준:
      - 무조건 제외 (회계법인 업무와 무관)
    
    

📊 B그룹: 맥락적 제외 (사업 연관성 기준)
   1. CSR/사회공헌/ESG 활동
      키워드: 기부, 환경 캠페인, 사회공헌, 나눔, 캠페인 진행, 봉사활동
      판단기준:
      - 단순 일회성 기부나 이벤트: 제외
      - 사업전략과 연계된 ESG 경영: 보류
      - 탄소중립, RE100 등 사업모델 변화 수반: 유지
      
   2. 신제품/서비스 관련
      키워드: 출시, 론칭, 신제품, 신서비스, 제품 개선
      판단기준:
      - 기존 제품라인 연장: 제외
      - 신사업 진출이나 시장 확장: 보류
      - 사업구조나 수익모델 변화: 유지

📈 C그룹: 맥락 우선 제외 (관대한 해석)
   1. 기술 성능/품질 관련 (완화 적용)
      키워드: 우수성 입증, 기술력 인정, 성능 비교, 품질 테스트, 기술 성과
      완화기준:
      - 단순 성능 홍보: 제외
      - ⚠️ 업계 최초, 글로벌 인증 등: 보류
      - ⚠️ 신기술 상용화나 특허 관련: 유지
      
   2. 시스템/서비스 운영 이슈 (완화 적용)
      키워드: 일시 중단, 접속 오류, 서비스 오류, 버그, 점검 중, 업데이트 실패
      완화기준:
      - 일반적인 점검: 제외
      - ⚠️ 반복적 문제나 고객 불만 증가: 보류
      - ⚠️ 보안사고, 시스템 마비: 유지

📉 D그룹: 정보성 뉴스 제외 (분석 가치 기준)
   1. 목표주가/투자의견
      키워드: 목표가, 목표주가, 목표주가 달성, 목표주가 도달, 목표주가 향상, 목표가↑, 목표가↓, 목표가 상향, 신고가 경신, 목표주가 상향, 목표주가 하향
      판단기준:
      - 무조건 제외 (회계법인 업무와 무관)
      
   2. 순위/비교성 보도 (완화 적용)
      키워드: 평균 연봉, 브랜드 가치 순위, 기업 순위, 만족도 조사
      완화기준:
      - 단순 순위: 제외
      - ⚠️ 순위 변동이나 업계 지위 변화: 보류
      - ⚠️ 경쟁력 분석이 포함된 경우: 유지
      
   3. 주식시장 기술적 분석
      키워드: 특징주, 특징주 선정, 급등주, 급락주, 거래량, 차트 분석
      → 무조건 제외 (회계법인 업무와 무관)
      
   4. 부동산 관련 (완화 적용)
      키워드: 재건축, 재건축 계획, 부동산 개발, 토지 매입
      완화기준:
      - 일반 부동산 투자: 제외
      - ⚠️ 사업 관련 부동산이나 대규모 거래: 보류

🔍 E그룹: 의미 확대 해석
   키워드: 오전 이슈, 호재, 악재, 시장 관심, 투자자 주목
   완화기준:
   - 추상적 표현만 있는 경우: 제외
   - ⚠️ 구체적 사실과 함께 언급된 경우: 보류

📍 4단계: 절대 유지 기준 (동일 유지)
────────────────────────────────────────────────────────────

💼 회계법인 핵심 관심사: (변경 없음)
• 재무제표, 실적 발표, 감사 관련 → 무조건 유지
• 회계처리 변경, 감사의견 → 무조건 유지

🏢 기업구조 변화: (변경 없음)
• M&A, 인수합병, 지분 변동 → 무조건 유지
• 자회사 설립/매각, 사업부 분할 → 무조건 유지

👔 경영진 변화: (변경 없음)
• 대표이사, 회장 등 최고경영진 → 무조건 유지
• 경영권 분쟁, 승계 이슈 → 무조건 유지

⚖️ 규제/법적 이슈: (변경 없음)
• 정부 정책의 직접적 사업 영향 → 무조건 유지
• 법적 분쟁, 소송, 규제 조치 → 무조건 유지

📍 5단계: 완화된 판단 가이드라인
────────────────────────────────────────────────────────────

🎯 완화된 핵심 질문:
1. "이 뉴스가 기업과 조금이라도 연관성이 있는가?"
2. "회계법인 관점에서 참고할 만한 가치가 전혀 없는가?"
3. "다른 기사들과 비교했을 때 상대적으로 나은 내용인가?"

🔄 관대한 판단 원칙:
• 의심스러우면 "보류" 우선 선택
• 절대 제외보다는 조건부 검토 우선
• 기업 규모나 중요도를 고려하여 완화 적용
• 다른 선택지가 부족할 때는 더욱 관대하게

⚠️ 매우 중요한 재평가 지침 ⚠️
1. 반드시 최소 1개 이상의 기사를 선정해야 합니다
2. 위 기준 중 어느 하나라도 해당하면 선정 고려
3. 중요도는 '상', '중', '하' 모두 허용하되, '하'라도 선정
4. 모든 기사가 부적합하다고 판단되더라도 상대적으로 가장 나은 기사들을 선정
5. 추가 언론사(철강금속신문, 에너지신문, 이코노믹데일리)의 기사도 동등하게 고려

✅ 완화 적용 예시:
- "삼성전자, 고객 만족도 조사 1위" → 보류 (경쟁력 관련성)
- "현대차, 친환경 캠페인 시작" → 보류 (ESG 전략 가능성)
- "KB금융, 직원 복지 프로그램 확대" → 보류 (조직문화/인재경영)

❓ 경계 케이스 관대 판단:
- "LG전자, 브랜드 광고 캠페인" → 보류 (브랜드 전략 관련성 검토)
- "SK하이닉스, 기술 우수성 인정받아" → 보류 (기술 경쟁력 관련성)

❌ 여전히 제외:
- "롯데자이언츠, 선수 트레이드"
- "삼성 주가 차트 분석"
- "삼성전자 주가, 장중 52주 신고가 경신"

"""

# 4단계: 그룹핑 완화 기준  
RELAXED_DUPLICATE_HANDLING = """중복 뉴스 처리 시 다음 완화된 기준을 적용하세요:

1. 중복 판단 완화
   - 동일한 사안이더라도 언론사별로 다른 관점이나 추가 정보가 있으면 별도 그룹으로 분류
   - 재무적/전략적 관점에서 추가 정보를 제공하는 기사는 중복이어도 우선 선택

2. 언론사 우선순위 (완화 적용)
   - 1순위: 경제 전문지 (한국경제, 매일경제, 조선비즈, 파이낸셜뉴스)
   - 2순위: 종합 일간지 (조선일보, 중앙일보, 동아일보)
   - 3순위: 통신사 (연합뉴스, 뉴스핌, 뉴시스)
   - 4순위: 추가 언론사 (철강금속신문, 에너지신문, 이코노믹데일리)
   - 5순위: 기타 언론사

3. 내용 완성도 우선 (강화)
   - 회계법인 관점에서 유용한 정보가 더 많은 기사 우선
   - 재무 수치, 경영진 코멘트, 전문가 의견이 포함된 기사 우선
   - 전략적 배경이나 시장 영향에 대한 분석이 포함된 기사 우선

⚠️ 재평가 완화 지침 ⚠️  
- 중복 기사 중에서도 회계법인 관점에서 가치가 있는 추가 정보가 있으면 별도 선택
- 언론사 신뢰도보다 기사 내용의 완성도와 회계법인 관련성을 우선 고려
"""

# 5단계: 선택 완화 기준
RELAXED_SELECTION_CRITERIA = """다음 완화된 기준으로 뉴스를 선택하세요:
1. 재무/실적 관련 정보 (최우선 순위)
   - 매출, 영업이익, 순이익 등 실적 발표
   - 재무제표 관련 정보
   - 배당 정책 변경

2. 회계/감사 관련 정보 (최우선 순위)
   - 회계처리 방식 변경
   - 감사의견 관련 내용
   - 내부회계관리제도
   - 회계 감리 결과
   
3. 구조적 기업가치 변동 정보 (높은 우선순위)
    - 신규사업/투자/계약에 대한 내용
    - 대외 전략(정부 정책, 글로벌 파트너, 지정학 리스크 등)
    - 기업의 새로운 사업전략 및 방향성, 신사업 등
    - 기업의 전략 방향성에 영향을 미칠 수 있는 정보
    - 기존 수입모델/사업구조/고객구조 변화
    - 공급망/수요망 등 valuechain 관련 내용 (예: 대형 생산지 이전, 주력 사업군 정리 등) 

4. 기업구조 변경 정보 (높은 우선순위)
   - 인수합병(M&A)
   - 자회사 설립/매각
   - 지분 변동
   - 조직 개편

추가 완화 기준:
5. 경영진/지배구조 변화 (중간 우선순위)
   - 임원 인사, 이사회 구성 변화
   - 대주주 변동, 지분 구조 변화
   - 경영권 분쟁이나 승계 관련

6. 규제/정책 영향 (중간 우선순위)
   - 정부 정책 변화가 기업에 미치는 영향
   - 규제 완화나 강화로 인한 사업 기회/위험
   - 산업 정책이나 법규 변화

7. 시장 지위 변화 (중간 우선순위)
   - 시장점유율 변화
   - 경쟁사 대비 상대적 위치 변화
   - 신규 경쟁자 진입이나 시장 구조 변화

8. 기타 기업 관련 이슈 (낮은 우선순위)
   - 기업명이 직접 언급되고 사업과 관련된 모든 내용
   - 계열사나 자회사 관련 중요 소식
   - 기업 브랜드나 평판에 영향을 줄 수 있는 이슈

⚠️ 매우 중요한 재평가 지침 ⚠️
1. 반드시 최소 1개 이상의 기사를 선정해야 합니다
2. 위 8개 기준 중 어느 하나라도 해당하면 선정 고려
3. 중요도는 '상', '중', '하' 모두 허용하되, '하'라도 선정
4. 모든 기사가 부적합하다고 판단되더라도 상대적으로 가장 나은 기사들을 선정
5. 최종 검증 (필수 확인사항) 🔍
   위 기준에 해당하는 뉴스라도 제목에 해당 기업명이나 관련 키워드가 포함되지 않은 기사는 제외
   • 각 회사별 키워드 목록은 COMPANY_KEYWORD_MAP 참조
   1) 제목과 내용에 해당 기업명이나 관련 키워드가 명확히 포함되어 있는가?
   2) 해당 기업이 기사의 주요 대상인가?
   3) 제목에서 해당 기업이 주어/주체로 언급되는가?
   4) 기업이 다른 회사에 대한 투자의견을 제시하는 기사는 아닌가?
    - 제외 기사 예시
    [키워드-키움증권] 키움증권 "달바글로벌 높은 해외 성장률, 글로벌 프리미엄 포지셔닝 강화" → 달바글로벌에 대한 의견제시이므로 제외
    [키워드-한국투자] 한국투자 'HD현대일렉트릭 목표주가 상향, 미국 초고압변압기 수출 증가로 실적 개선' → HD현대일렉트릭에 대한 의견제시이므로 제외
    [키워드-교보증권] 오리온 6월 매출 성장률 둔화, 교보증권 "하반기 추경과 신제품 출시 기대" → 오리온에 대한 의견제시이므로 제외
    [키워드-NH] 기업은행, 2Q 실적 양호…건전성 부담은 확대-NH → 기업은행에 대한 의견제시이므로 제외"""
    
    
